config:
  inherit-env: true

# tests have letter prefix to ensure execution in correct order (execution seems to be alphabetical for commander)
tests:
  aa it should fail (missing --dfam):
    command: perl table_parser.pl --dfam --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv tparse_test/tsv --index_charts tparse_test/indexcharts
    stderr:
      contains:
        - "--dfam input is not a directory:"
    exit-code: 2

  ab it should fail (missing --bac_genomes):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes --job_number 0 --tsv tparse_test/tsv --index_charts tparse_test/indexcharts
    stderr:
      contains:
        - "--bac_genomes input is not a directory:"
    exit-code: 2

  ac it should fail (missing --job_number):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number --tsv tparse_test/tsv --index_charts tparse_test/indexcharts
    stderr:
      contains:
        - |
          Value "--tsv" invalid for option job_number (number expected)
          Unknown option, try --help
    exit-code: 255

  ad it should fail (missing --tsv):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv --index_charts tparse_test/indexcharts
    stderr:
      contains:
        - "--tsv input is not a directory:"
    exit-code: 2

  ae it should fail (missing --index_charts):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv tparse_test/tsv/ --index_charts
    stderr:
      contains:
        - Option index_charts requires an argument
    exit-code: 255

  ba it should fail (--dfam is file, not dir):
    command: perl table_parser.pl --dfam tparse_test/commander/dummy/random_file.txt --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv tparse_test/tsv --index_charts tparse_test/indexcharts
    stderr:
      contains:
        - "--dfam input is not a directory:"
    exit-code: 255

  bb it should fail (--bac_genomes is file, not dir):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/commander/dummy/random_file.txt --job_number 0 --tsv tparse_test/tsv --index_charts tparse_test/indexcharts
    stderr:
      contains:
        - "--bac_genomes input is not a directory:"
    exit-code: 255

  bc it should fail (--job_number is a string, not a number):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number bob --tsv tparse_test/tsv --index_charts tparse_test/indexcharts
    stderr:
      contains:
        - |
          Value "bob" invalid for option job_number (number expected)
          Unknown option, try --help
    exit-code: 255

  bd it should fail (--tsv is file instead of dir):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv tparse_test/commander/dummy/random_file.txt --index_charts tparse_test/indexcharts
    stderr:
      contains:
        - "--tsv input is not a directory:"
    exit-code: 255

  be it should fail (--index_charts is file instead of dir):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv tparse_test/tsv/ --index_charts tparse_test/commander/dummy/random_file.txt
    stderr:
      contains:
        - "--index_charts input is not a directory:"
    exit-code: 255

  ca it should fail (input .dfam files empty):
    command: perl table_parser.pl --dfam tparse_test/commander/dummy/nonsense_dfam --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv tparse_test/commander/dummy/nonsense_output --index_charts tparse_test/commander/dummy/nonsense_output
    stderr:
      contains:
        - "input .dfam file empty"
    exit-code: 255

  cb it should fail (input genome empty):
    command: perl table_parser.pl --dfam tparse_test/dfam --bac_genomes tparse_test/commander/dummy/nonsense_genome --job_number 0 --tsv tparse_test/commander/dummy/nonsense_output --index_charts tparse_test/commander/dummy/nonsense_output
    stderr:
      contains:
        - "input bacterial genome file empty"
    exit-code: 255

  cc-1 it should fail (job_number is negative):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number -1 --tsv tparse_test/tsv/ --index_charts tparse_test/indexcharts/
    stderr: "--job_number must be 0 or positive:"
    exit-code: 2

  cc-2 it should fail (job_number is extremely large):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number 1000000000000 --tsv tparse_test/tsv/ --index_charts tparse_test/indexcharts/
    stderr:
      contains:
        - No DFAM table corresponding to index 1000000000000
    exit-code: 2

  cc-3 it should fail (job_number is very large and negative):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number -1000000000000 --tsv tparse_test/tsv/ --index_charts tparse_test/indexcharts/
    stderr: "--job_number must be 0 or positive:"
    exit-code: 2

  cd it should fail (--tsv doesn't exist):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv tparse_test/commander/dummy/idontexist/ --index_charts tparse_test/commander/dummy/nonsense_output
    stderr: --tsv input is not a directory
    exit-code: 2

  ce it should fail (--index_charts doesn't exist):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv tparse_test/commander/dummy/nonsense_output --index_charts tparse_test/commander/dummy/idontexist
    stderr: --index_charts input is not a directory
    exit-code: 2

  da it should fail (--dfam points to directory with wrong format files):
    command: perl table_parser.pl --dfam tparse_test/commander/dummy/wrong_format/ --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv tparse_test/commander/dummy/nonsense_output --index_charts tparse_test/commander/dummy/nonsense_output
    stderr:
      contains:
        - Can't extract genome name from table path
    exit-code: 255

  db it should fail (--bac_genomes points to dir with wrong format files):
    command: perl table_parser.pl --dfam tparse_test/dfam/ --bac_genomes tparse_test/commander/dummy/wrong_format/ --job_number 0 --tsv tparse_test/commander/dummy/nonsense_output --index_charts tparse_test/commander/dummy/nonsense_output --force
    stderr:
      contains:
        - No such file tparse_test/commander/dummy/wrong_format//Pseudomonas_aeruginosa_12-4-4_59__3618.fna
    exit-code: 1

  fa it should succeed (correct inputs across the board, 0 for job_number):
    command: perl table_parser.pl --dfam tparse_test/dfam --bac_genomes tparse_test/bac_genomes/ --job_number 0 --tsv tparse_test/tsv --index_charts tparse_test/indexcharts --force
    stdout:
    exit-code: 0