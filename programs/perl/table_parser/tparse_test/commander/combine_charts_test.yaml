config:
  inherit-env: true

# tests have letter prefix to ensure execution in correct order (execution seems to be alphabetical for commander)
tests:
  aa it should fail (missing --inputdir):
    command: perl combine_charts.pl --inputdir --outputdir tparse_test/commander/dummy/nonsense_output/
    stderr: --inputdir value is not a directory
    exit-code: 2

  ab it should fail (missing --outputdir):
    command: perl combine_charts.pl --inputdir tparse_test/indexcharts/ --outputdir
    stderr:
      contains:
        - Option outputdir requires an argument
    exit-code: 255

  ba it should fail (--inputdir is file, not dir):
    command: perl combine_charts.pl --inputdir tparse_test/commander/dummy/random_file.txt --outputdir tparse_test/commander/dummy/nonsense_output
    stderr: --inputdir value is not a directory
    exit-code: 255

  bb it should fail (--outputdir is file, not dir):
    command: perl combine_charts.pl --inputdir tparse_test/commander/dummy/ --outputdir tparse_test/commander/dummy/random_file.txt
    stderr:
      contains:
        - --outputdir value is not a directory
    exit-code: 255

  ca it should fail (input files are empty):
    command: perl combine_charts.pl --inputdir tparse_test/commander/dummy/empty_indexcharts --outputdir tparse_test/commander/dummy/nonsense_output --force
    stderr: empty index file
    exit-code: 255

  # output directory should be fine with empty dir  
  cb it should succeed (outputdir empty):
    command: perl combine_charts.pl --inputdir tparse_test/indexcharts --outputdir tparse_test/commander/dummy/empty_output
    exit-code: 0

  da it should fail (file in input dir with wrong format):
    command: perl combine_charts.pl --inputdir tparse_test/commander/dummy/index_wrong_format/ --outputdir tparse_test/commander/dummy/empty_output
    stderr:
      contains:
        - Unable to parse file name
    exit-code: 255

  db-1 it should fail (outputdir has output already in it, --force not enabled):
    command: perl combine_charts.pl --inputdir tparse_test/indexcharts/ --outputdir tparse_test/commander/dummy/empty_output
    stderr:
      contains:
        - To overwrite any files that already exist, rerun with --force option
    exit-code: 255

  db-2 it should succeed (outputdir has output already in it, --force enabled):
    command: perl combine_charts.pl --inputdir tparse_test/indexcharts/ --outputdir tparse_test/commander/dummy/empty_output --force
    exit-code: 0

  db-3 rm files for future tests:
    command: rm -r tparse_test/commander/dummy/empty_output/*
    exit-code: 0

  ea it should succeed:
    command: perl combine_charts.pl --inputdir tparse_test/indexcharts/ --outputdir tparse_test/comb_chart --force
    exit-code: 0