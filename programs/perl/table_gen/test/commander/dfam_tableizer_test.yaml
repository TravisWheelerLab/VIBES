config:
  inherit-env: true

# tests have letter prefix to ensure execution in correct order (execution seems to be alphabetical for commander)
tests:
  aa it should fail (missing hmm_db):
    command: perl dfam_tableizer.pl --hmm_db -j 1 -d test/dfam/ -g test/genomes/ -s test/scanned_dfam
    stderr:
      contains: 
        - "--hmm_db is not a file"
    exit-code: 2

  ab it should fail (missing job_number):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm -j -d test/dfam/ -g test/genomes/ -s test/scanned_dfam
    stderr: |
      Value "-d" invalid for option job_number (number expected)
      Unknown argument, try --help
    exit-code: 255

  ac it should fail (missing dfam_dir):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm test/test_hmm/test_hmm.hmm -j 1 -d -g test/genomes/ -s test/scanned_dfam
    stderr: 
      contains:
        - --dfam_dir input is not a directory
    exit-code: 2

  ad it should fail (missing gen_dir):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm -j 1 -d test/dfam/ -g -s test/scanned_dfam
    stderr: 
      contains:
        - --gen_dir input is not a directory
    exit-code: 2

  ae it should fail (missing scan_dir):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm -j 1 -d test/dfam/ -g test/genomes -s
    stderr: 
      contains:
        - |
          Option scan_dir requires an argument
          Unknown argument, try --help
    exit-code: 255

  ba it should fail (hmm_db is dir instead of file):
    command: perl dfam_tableizer.pl --hmm_db test/random_dir/ -j 1 -d test/dfam/ -g test/genomes/ -s test/scanned_dfam
    stderr:
      contains: 
        - "--hmm_db is not a file"
    exit-code: 255

  bb it should fail (job_number is file instead of number ):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm -j test/random_dir -d test/dfam/ -g test/genomes/ -s test/scanned_dfam
    stderr: |
      Value "test/random_dir" invalid for option job_number (number expected)
      Unknown argument, try --help
    exit-code: 255

  bc it should fail (dfam_dir is file instead of dir):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm test/test_hmm/test_hmm.hmm -j 1 -d test/random.txt -g test/genomes/ -s test/scanned_dfam
    stderr: 
      contains:
        - --dfam_dir input is not a directory
    exit-code: 2

  bd it should fail (gen_dir is file instead of dir):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm -j 1 -d test/dfam/ -g test/random.txt -s test/scanned_dfam
    stderr: 
      contains:
        - --gen_dir input is not a directory
    exit-code: 2

  be it should fail (scan_dir is file instead of dir):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm -j 1 -d test/dfam/ -g test/genomes -s test/random.txt
    stderr: 
      contains:
        - --scan_dir input is not a directory
    exit-code: 2

  ca it should fail (.hmms are empty):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/empty_hmm/test_hmm.hmm -j 1 -d test/dfam/ -g test/genomes -s test/scanned_dfam
    stderr:
      contains:
        - "command returned error:"
    exit-code: 1

  cb-1 it should fail (job_number is negative):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm -j -1 -d test/dfam/ -g test/genomes/ -s test/scanned_dfam
    stderr: "--job_number must be 0 or positive:"
    exit-code: 255

  cb-2 it should fail (job_number is extremely large, no corresponding genome exists):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm -j 1000000000000 -d test/dfam/ -g test/genomes/ -s test/scanned_dfam
    stderr:
      contains:
        - No genome corresponding to index 1000000000000
    exit-code: 2

  cb-3 it should fail (job_number is extremely large and negative, no corresponding genome exists):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm -j -1000000000000 -d test/dfam/ -g test/genomes/ -s test/scanned_dfam
    stderr:
      contains:
        - "--job_number must be 0 or positive:"
    exit-code: 255

  # empty --dfam_dir is fine, since we store output there
  cc it should succeed (dfam_dir is empty):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm test/test_hmm/test_hmm.hmm -j 1 -d test/dfam/empty -g test/genomes/ -s test/scanned_dfam
    stdout:
    exit-code: 0

  cc-1 remove any output from empty dfam dir:
    command: rm test/dfam/empty/*
    stdout:
    exit-code: 0

  cd it should fail (gen_dir is empty):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm -j 1 -d test/dfam/ -g test/genomes/empty -s test/scanned_dfam
    stderr: 
      contains:
        - No genome corresponding to index 1
    exit-code: 2

  # scan_dir is an output directory, so it being empty shouldn't matter
  ce it should succeed (scan_dir is empty):
    command: perl dfam_tableizer.pl --hmm_db test/test_hmm/test_hmm.hmm test/test_hmm/test_hmm.hmm -j 1 -d test/dfam/ -g test/genomes/ -s test/scanned_dfam/empty
    stdout:
    exit-code: 0

  ce-1 remove any output from empty scanned dfam dir:
    command: rm test/scanned_dfam/empty/*
    stdout:
    exit-code: 0