=====
perl hmmbuild_mult_seq.pl ../../sequence_files/prophage/all_prophage_seq.fasta
hmmpress all_prophage_seqs.hmm
nhmmscan --dfamtblout tables/test_run_table.dfam --cpu 3 prophage_seq/all_prophage_seqs.hmm genomes/Pseudomonas_aeruginosa_12-4-4_59__3618.fna
perl dfamscan.pl --dfam_infile  ../../tables/dfam/test_run_table.dfam --dfam_outfile ../../tables/dfam/test_run_filtered.dfam

perl hmmbuild_mult_seq.pl ../../sequence_files/att/att_seq.fasta
cat *.hmm > all_att_seq.hmm
hmmpress all_att_seq.hmm
nhmmscan --dfamtblout tables/att_test.dfam att_seq/all_att_seq.hmm genomes/Pseudomonas_aeruginosa_12-4-4_59__3618.fna
perl dfamscan.pl --dfam_infile  ../../tables/dfam/att_test.dfam --dfam_outfile ../../tables/dfam/att_test_scanned.dfam

=====
perl hmmbuild_mult_seq.pl ../../sequence_files/prophage/prophage_seq.fasta
cat *.hmm > all_prophage_seq.hmm
hmmpress all_prophage_seq.hmm
nhmmscan --dfamtblout tables/test_strain_names_viral.dfam --cpu 3 prophage_seq/all_prophage_seq.hmm genomes/Pseudomonas_aeruginosa_12-4-4_59__3618.fna
perl dfamscan.pl --dfam_infile  ../../tables/dfam/test_strain_names_viral.dfam --dfam_outfile ../../tables/dfam/names_viral_scanned.dfam

perl hmmbuild_mult_seq.pl ../../sequence_files/att/att_seq.fasta
cat *.hmm > all_att_seq.hmm
hmmpress all_att_seq.hmm
nhmmscan --dfamtblout tables/att_test.dfam att_seq/all_att_seq.hmm genomes/Pseudomonas_aeruginosa_12-4-4_59__3618.fna
perl dfamscan.pl --dfam_infile  ../../tables/dfam/att_names_test.dfam --dfam_outfile ../../tables/dfam/att_names_test_scanned.dfam

=====
perl tableizer.pl ../genomes/ ../prophage_seq/all_prophage_seq.hmm ../tables
perl tableizer.pl ../genomes/ ../att_seq/all_att_seq.hmm ../tables

=====
SPADES on WGS Sequence
spades_PAO1:
spades.py -1 PAO1_R1_001.fastq -2 PAO1_R2_001.fastq -o ~/assembled_genomes/Pat_WGS_Sequence/PAO1/

spades_PAO1_wt_Pf4:
spades.py -1 PAO1-wt-Pf4_R1_001.fastq -2 PAO1-wt-Pf4_R2_001.fastq -o ~/assembled_genomes/Pat_WGS_Sequence/PAO1_wt_Pf4/

spades_PAO1_rec_Pf4:
spades.py -1 PAO1-rec-Pf4_R1_001.fastq -2 PAO1-rec-Pf4_R2_001.fastq -o ~/assembled_genomes/Pat_WGS_Sequence/PAO1_rec_Pf4/

=====
NHMMER on SPADES Pseudomnas contigs

nhmmer --tblout prophage_search.tbl  -o prophage_search.afa Pf_prophage_strain_PAO1__Reference_strain_.fasta test.fasta
nhmmer --tblout 200_contigs.tbl  -o 200_contigs.out ../Pf_prophage_strain_PAO1__Reference_strain_.fasta 200_filtered_contigs.fasta
nhmmer --tblout 200_scaffolds.tbl  -o 200_scaffolds.out ../Pf_prophage_strain_PAO1__Reference_strain_.fasta 200_filtered_scaffolds.fasta
nhmmer --tblout 1k_scaffolds.tbl  -o 1k_scaffolds.out ../Pf_prophage_strain_PAO1__Reference_strain_.fasta 1k_filtered_scaffolds.fasta

nhmmer --tblout contigs/PAO1_rec_Pf4_1k.tbl -o contigs/PAO1_rec_Pf4_1k.out Pf_prophage_strain_PAO1__Reference_strain_.fasta contigs/PAO1_rec_Pf4_1k.fasta
nhmmer --tblout contigs/PAO1_rec_Pf4_200.tbl -o contigs/PAO1_rec_Pf4_200.out Pf_prophage_strain_PAO1__Reference_strain_.fasta contigs/PAO1_rec_Pf4_200.fasta
nhmmer --tblout contigs/PAO1_wt_Pf4_200.tbl -o contigs/PAO1_wt_Pf4_200.out Pf_prophage_strain_PAO1__Reference_strain_.fasta contigs/PAO1_wt_Pf4_200.fasta
nhmmer --tblout contigs/PAO1_wt_Pf4_1k.tbl -o contigs/PAO1_wt_Pf4_1k.out Pf_prophage_strain_PAO1__Reference_strain_.fasta contigs/PAO1_wt_Pf4_1k.fasta

(PAO1OR)
nhmmer --tblout contigs/PAO1_wt_Pf4_1k_PAO1OR.tbl -o contigs/PAO1_wt_Pf4_1k_PAO1OR.out Pseudomonas_aeruginosa_genome_assembly_PAO1OR.fasta contigs/PAO1_wt_Pf4_1k.fasta

=====
Stanford Mini-Pipeline (Mid-Late October 2018)
hmmbuild --amino coab_les.hmm coaB_LES.fasta
hmmbuild --amino coab_pf4.hmm coaB_Pf4.fasta

See text_files folder for msub cluster commands

phmmert -o text_files/phmmert_out/les/e(e-value).out sequence_files/hmm/coab_(isoform).hmm sequence_files/pseudomonas/(genome)

=====
Attempt to address poorly defined viral sequences (January 2019)
nhmmer -o ref_vs_all_prophage.afa Pf_prophage_strain_PAO1__Reference_strain_.fasta prophage_seq/prophage_seq.fasta

=====
Viral Genome Alignment to TIGRFAM DB (Jan 2019)
hmmscant --tblout protein_annotated_prophages.tbl TIGRFAM.HMM ../prophage/prophage_seq.fasta

(this one yielded actual table we're actually going to use as of 1/29)
 hmmscant --domtblout protein_annotated_prophages.domtbl TIGRFAM.HMM ../prophage/prophage_seq.fasta

 =====
 Thu Jun  6 14:27:47 MDT 2019
Annotating Pseudomonas Prophages with Viral Protein Database (from uniprot reference seqs)

Downloaded reviewed viral proteins from https://www.uniprot.org/uniprot/?query=reviewed:yes%20taxonomy:10239

On bioinfo:
perl hmmbuild_mult_seq.pl --input ../seq/viral_proteins_swissprot/uniprot-reviewed-viral.fasta --output ../hmm/viral_proteins/swissprot_viral_prots.hmm --amino --cpu 4 --verbose

hmmpress swissprot_viral_prots.hmm

hmmscant --domtblout tables/domtbl/uniprot_annotated_prophages.domtbl hmm/viral_proteins/swissprot_viral_prots.hmm seq/prophage_seq/prophage_seq.fasta (goddamnit, wrong program...)

perl fasta_split.pl --input ../../../sequence_files/prophage/prophage_seq.fasta --output ../../../sequence_files/prophage/individual_phage/

python3 generate_domtbls.py ../seq/prophage_seq/individual_phage/ ../hmm/viral_proteins/swissprot_viral_prots.hmm ../tables/domtbl/ (on bioinfo)

hmmstat swissprot_viral_prots.hmm >swissprot_viral_prots.hmmstat

downloaded all complete genomes from pseudomonas.com: http://pseudomonas.com/strain/download?c1=organism&v1=&v2=complete&c2=assemblyLevel (335 at time of writing on June 14th)

perl hmmbuild_mult_seq.pl --input ../../../sequence_files/prophage/prophage_seq.fasta --output ../../../hmm/prophage_genomes/50_ref_phage.hmm --verbose

hmmpress 50_ref_phage.hmm

Ran 2019-06-14_complete.sh on HPC (50 reference phages vs. 335 complete Ps genomes from pseudomonas.com)

Ran 2019-06-19_table_parser_complete.sh on HPC

perl scan_domtbls.pl --input ../../../tables/domtbl/viral_prot_unscanned/ --output ../../../tables/domtbl/2019-06-21_viral_prot_scanned/ (output available in 2019-06-21_scan_domtbls) (Redid this command after editing scan_domtbls to sort output by sequence start location rather than e-value)

Thu Jun 27 15:28:59 MDT 2019
Added Pat's recombinase, pseudogene seq to viral protein database in uniprot-reviewed-and-pat-seq.fasta
perl hmmbuild_mult_seq.pl --input ../seq/viral_proteins_swissprot/uniprot-reviewed-and-pat-seq.fasta --output ../hmm/viral_proteins/swissprot_and_pat_seq.hmm --amino --cpu 6 --verbose on bioinfo)

python3 generate_domtbls.py ../seq/prophage_seq/individual_phage/ ../hmm/viral_proteins/swissprot_and_pat_seq.hmm ../tables/domtbl/2019-06-27_viral_prot_swiss_pat_unscanned/ (on bioinfo)

perl scan_domtbls.pl --input ../../../tables/domtbl/2019-06-27_viral_prot_swiss_pat_unscanned/ --output ../../../tables/domtbl/2019-06-27_viral_prot_swiss_pat_scanned/ --verbose

perl combine_charts.pl --inputdir ../../../tables/nuc_chart/2019-06-19_complete --outputdir ../../../tables/nuc_chart/2019-06-19_complete_combined_test/ --verbose
(generated lab meeting chart counts)

esl-sfetch -o LES400_partial.fasta -c 10600..13728 Pf_prophage_strain_LES400.fasta "Pf_prophage_strain_LES400"

esl-sfetch -o X13273_1374860_partial -c 3600..5500 Pf_prophage_strain_X13273_1374860–1380892.fasta Pf_prophage_strain_X13273_1374860–1380892

esl-translate LES400_partial.fasta

esl-translate X13273_1374860_partial.fasta

==== Add Pfam to annotate step

Downloaded Pfam-A.hmm.gz from ftp://ftp.ebi.ac.uk/pub/databases/Pfam/current_release on Wed Jul  3 17:00:54 MDT 2019

gunzip Pfam-A.hmm.gz

python3 generate_domtbls.py ../seq/prophage_seq/individual_phage/ ../hmm/Pfam_A/Pfam-A.hmm ../tables/domtbl/2019-07-03_Pfam_A_prophage_unscanned/

==== Updated hmmer to 3.3dev
Downloaded all pseudmonas draft genomes on Pseudomonas.com (07/22/2019, totalling 4512)

perl fasta_split.pl --input ../../../sequence_files/viral_proteins/nuc/Pat_nuc_seqs.fasta --output ../../../sequence_files/viral_proteins/nuc/

perl hmmbuild_mult_seq.pl --input ../../../sequence_files/viral_proteins/nuc/Pat_nuc_seqs.fasta --output ../../../hmm/viral_proteins/2019-07-24_pat_nuc_seqs.hmm --verbose --dna --hmmpress

Reinstalled hmmer 3.3dev on HPC:
autoconf
./configure --prefix="$HOME/myapps"
make (got clock skew warning)
make install

== Updated generate_domtbls.py to allow for alt genetic codes (08/02/2019)
python3 generate_domtbls.py ../../seq/prophage_seq/individual_phage/ ../../hmm/viral_proteins/swissprot_viral_prots.hmm ../../tables/domtbl/2019-08-02_swissprot_prophage_code11/ --genetic_code 11 (on bioinfo)

Ran 2019-08-02_complete_tableizer_3.3dev.sh on HPC. Three of these (Pseudomonas_citronellolis_P3B5_4025, Pseudomonas_citronellolis_SJTE-3_4026, Pseudomonas_furukawaii_KF707_5864) failed to complete because they exceeded the 4 hour 30 min time limit. These were rerun individually, with their own .sh files.

These .sh files were:
2019-08-05_cleanup_long_run_1.sh
2019-08-05_cleanup_long_run_2.sh
2019-08-05_cleanup_long_run_3.sh

Ran scan_domtbls.pl: perl scan_domtbls.pl --input ../../../tables/domtbl/2019-08-02_swissprot_prophage_code11 --output ../../../tables/domtbl/2019-08-02_swissprot_prophage_code11_scanned/ -v

python visualize_nucleotide_counts.py ../../../tables/nuc_chart/2019-06-19_complete_combined_test/ test/test_output/ --swissprot_domtbl ../../../tables/domtbl/2019-08-02_swissprot_prophage_code11_scanned/ --pfam_domtbl ../../../tables/domtbl/2019-07-03_Pfam_A_prophage_scanned/

perl hmmbuild_mult_seq.pl --amino --hmmpress -input ../seq/viral_protein/uniprot-reviewed-viral-coat-prot.fasta --output ../hmm/viral_proteins/2019-08-12_swissprot_coat_prots.hmm --cpu 6 -v (on bioinfo)

Ran 2019-08-06_draft_tblzr_3.3d.sh on HPC. Of the ~4500 subjobs, ~20 failed to complete for reasons that aren't yet entirely clear (some are definitely due to running too long, but others may have been killed similar to problems encountered earlier with the job manager). Any individual runs in interactive instances or
via 1-job (individual) .sh files will be recorded below.



======
Generated Plots for Travis (week of Sept 9th 2019)

Prophage Occurrence Plot command:
python visualize_nucleotide_counts.py ../../../tables/nuc_chart/2019-06-19_complete_combined_test/ test/test_output/ --swissprot_domtbl ../../../tables/domtbl/2019-08-02_swissprot_prophage_code11_scanned/ --pfam_domtbl ../../../tables/domtbl/2019-07-03_Pfam_A_prophage_scanned/ --dfam_dir ../../../tables/dfam/2019-07-25_phage_nuc_annotations_scanned/

Integrase Plot command:
python integrase_dist_plot.py test/test_output/integrase_dist_plot.pdf --swissprot_domtbl ../../../tables/domtbl/2019-08-02_swissprot_prophage_code11_scanned/  --pfam_domtbl ../../../tables/domtbl/2019-07-03_Pfam_A_prophage_scanned/  --swissprot_fasta ../../../sequence_files/viral_proteins/amino/uniprot-reviewed-viral-coat-prot.fasta --dfam_dir ../../../tables/dfam/2019-07-25_phage_nuc_annotations_scanned/ --dfam_fasta ../../../sequence_files/viral_proteins/nuc/all_nuc_seqs.fasta --bac_dfams test/bac_dfam/

====
Ran table_parser.pl on complete Ps genomes (9/30 - 10/5)
ran msub 2019-09-30_complete_parser.sh on HPC server

=====
(10/13/2019)
Ran "perl find_trna.pl --input_dir ../seq/pseudomonas/complete_genomes/ --prefix Ps --output_dir ../fasta/trna/ -v -f" on bioinfo
Ran  "mafft --auto fasta/trna/Ps_Gly.fasta > afa/trna/Ps_Gly.afa" on bioinfo
Ran "hmmbuild hmm/trna/Ps_Gly.hmm afa/trna/Ps_Gly.afa" on bioinfo
Ran "hmmpress hmm/trna/Ps_Gly.hmm" on bioinfo
Ran "nhmmscan --dfamtblout tables/dfam/trna_test/all_gly_ref_bac.dfam hmm/trna/Ps_Gly.hmm seq/pseudomonas/complete_genomes/Pseudomonas_aeruginosa_PAO1_107.fna" on bioinfo

# I wasn't happy with the quality of the MSAs, so I decided to try just the aeruginosa species:
Ran "perl find_trna.pl --input_dir ../seq/pseudomonas/complete_aeruginosa/ --prefix Ps_aeruginosa --output_dir ../fasta/aeruginosa_trna/ -v -f" on bioinfo
Ran "mafft --auto fasta/aeruginosa_trna/Ps_aeruginosa_Gly.fasta > afa/aeruginosa_trna/Ps_aeruginosa_Gly.afa" on bioinfo
Ran "hmmbuild hmm/trna/Ps_aeruginosa_Gly.hmm afa/aeruginosa_trna/Ps_aeruginosa_Gly.afa" on bioinfo
Ran "hmmpress hmm/trna/Ps_aeruginosa_Gly.hmm" on bioinfo
Ran "nhmmscan --dfamtblout tables/dfam/trna_test/aeruginosa_gly_ref_bac.dfam hmm/trna/Ps_aeruginosa_Gly.hmm seq/pseudomonas/complete_genomes/Pseudomonas_aeruginosa_PAO1_107.fna" on bioinfo

(10/17/2019)
Ran "perl perl/align_seqs.pl --input_dir fasta/aeruginosa_trna/ --output_dir afa/aeruginosa_trna/ -v --thread 6" on bioinfo
Ran "perl perl/align_seqs.pl --input_dir fasta/trna/ --output_dir afa/trna/ -v --thread 6" on bioinfo

(10/28/2019)
perl perl/hmmbuild_mult_fasta.pl --input_dir afa/aeruginosa_trna/ --output_dir hmm/aeruginosa_trna/ --cpu 6 -v
rm *.hmm.* # I realized that I probably wanted all of these in the same .hmm folder...
cat *.hmm > test_aer_trna.hmm
hmmpress test_aer_trna.hmm

=====
(10/24/2019)
Created TravisWheelerLab GitHub repo for code and pushed to it:
git remote add origin https://github.com/TravisWheelerLab/pseudomonas_pipeline.git
git push -u origin master
git push -u origin development

=====
(10/31/2019)
Removed dashes from Pat's prophage alignment
perl remove_dashes.pl --input "all Pf prophage alingment.fasta" --output all_Pf_prophage.fasta
(on bioinfo) mafft --reorder --thread 6 fasta/all_Pf_prophage.fasta > afa/all_Pf_prophage_ali_mafft.afa
perl fetch_ali_column.pl --coords 13982..30241 --input all_Pf_prophage_ali_mafft.afa --output all_Pf_prophage_ali_mafft_13982-30241.afa
esl-reformat -d afa all_Pf_prophage_ali_mafft.afa > pf_prophage_mafft_dna.afa # exactly one phage was from RNA and used U's instead of T's, so we convert to DNA to make # FastTree happy 
FastTree -nt pf_prophage_mafft_dna.afa > ../newick/pf_prophage_mafft_dna_full.newick
esl-reformat -d afa all_Pf_prophage_ali_mafft_13982-30241.afa > pf_prophage_mafft_dna_13982-30241.afa
FastTree -nt pf_prophage_mafft_dna_13982-30241.afa > ../newick/pf_prophage_mafft_dna_core.newick

# after extending core genome region:
perl fetch_ali_column.pl --coords 13982..33333 --input all_Pf_prophage_ali_mafft.afa --output all_Pf_prophage_ali_mafft_13982-33333.afa
esl-reformat -d afa all_Pf_prophage_ali_mafft_13982-33333.afa > pf_prophage_mafft_dna_13982-33333.afa
FastTree -nt pf_prophage_mafft_dna_13982-33333.afa > ../newick/pf_prophage_mafft_dna_core_33333.newick

# downloaded bactieral seq in .fasta format
All Swissprot bacterial protein sequence: https://www.uniprot.org/uniprot/?query=reviewed%3Ayes+taxonomy%3A%22Bacteria+%5B2%5D%22&sort=score
All Pseudomonas Swissprot protein sequence: https://www.uniprot.org/uniprot/?query=organism:pseudomonas&fil=reviewed%3Ayes&sort=score

gunzip uniprot-organism%3Apseudomonas-filtered-reviewed%3Ayes.fasta.gz
mv uniprot-organism%3Apseudomonas-filtered-reviewed%3Ayes.fasta uniprot_ps_prot.fasta

# used regex statement to capture accession IDs, replace with accID_bac
\|(.+?)\|
\|$1_bac\|
perl hmmbuild_mult_seq.pl --input ../seq/fasta/bacterial_protein/uniprot_ps_prot_bac.fasta --output ../hmm/viral_protein/ps_bac_prot.hmm --cpu 16 --verbose --amino

cat ps_bac_prot.hmm > 2019-11-04_viral_bac_prot.hmm
cat swissprot_viral_prots.hmm >> 2019-11-04_viral_bac_prot.hmm

# created 2019-11-05_prophage_seq.fasta by removing dashes from Pat's .afa
 perl fasta_split.pl -i  ../../../sequence_files/prophage/2019-11-05_prophage_seq.fasta -o ../../../sequence_filesprophage/2019-11-05_individual_phage/

 # manually moved selected review phages to their own dir

hmmpress Pfam-A.hmm
hmmpress 2019-11-04_viral_bac_prot.hmm

python3 generate_domtbls.py --g 11 ../seq/fasta/review_paper_phage/ ../hmm/viral_protein/2019-11-04_viral_bac_prot.hmm ../tables/domtbl/2019-11-05_rev_phage_swissprot/
python3 generate_domtbls.py --g 11 ../seq/fasta/review_paper_phage/ ../hmm/Pfam-A.hmm ../tables/domtbl/2019-11-05_rev_phage_pfam/

perl scan_domtbls.pl --input ../../../tables/domtbl/2019-11-05_rev_phage_swissprot --output ../../../tables/domtbl/2019-11-05_rev_phage_swissprot_scanned/ -v
perl scan_domtbls.pl --input ../../../tables/domtbl/2019-11-05_rev_phage_pfam --output ../../../tables/domtbl/2019-11-05_rev_phage_pfam_scanned/ -v

perl spoof_charts.pl --input_dir ../../../sequence_files/prophage/review_paper_example_phage/ -o spoof_charts/
python visualize_nucleotide_counts.py spoof_charts/ rev_paper_phage/ --swissprot_domtbl ../../../tables/domtbl/2019-11-05_rev_phage_swissprot_scanned/ --pfam_domtbl ../../../tables/domtbl/2019-11-05_rev_phage_pfam_scanned/


#realized that phage seq are included in pseudomonas protein databases- updated search to exclude them
All Swissprot Ps. seqs w/o phage: https://www.uniprot.org/uniprot/?query=organism%3Apseudomonas+NOT+organism%3Aphage+reviewed%3Ayes&sort=score

perl hmmbuild_mult_seq.pl --input ../seq/fasta/bacterial_protein/swissprot_ps_seq_no_phage_bac.fasta --output ../hmm/viral_protein/2019-11-05_swiss_bac_no_phage.hmm --cpu 16 --verbose --amino

cat swissprot_viral_prots.hmm > 2019-11-05_viral_and_no_phage_bac.hmm
cat 2019-11-05_swiss_bac_no_phage.hmm >> 2019-11-05_viral_and_no_phage_bac.hmm
hmmpress 2019-11-05_viral_and_no_phage_bac.hmm

python3 generate_domtbls.py --g 11 ../seq/fasta/review_paper_phage/ ../hmm/viral_protein/2019-11-05_viral_and_no_phage_bac.hmm ../tables/domtbl/2019-11-05_rev_phage_swissprot/ --force

perl scan_domtbls.pl --input ../../../tables/domtbl/2019-11-05_rev_phage_swissprot --output ../../../tables/domtbl/2019-11-05_rev_phage_swissprot_scanned/ -v --force

python visualize_nucleotide_counts.py spoof_charts/ better_rev_prophage/ --swissprot_domtbl ../../../tables/domtbl/2019-11-05_rev_phage_swissprot_scanned/ --pfam_domtbl ../../../tables/domtbl/2019-11-05_rev_phage_pfam_scanned/

# Added Pf1 and Pf7 seq to 2019-11-05_prophage_seq.fasta
mafft --reorder --thread 6 fasta/2019-11-05_prophage_seq.fasta > afa/2019-11-05_prophage_seq.afa
perl fetch_ali_column.pl --coords 13982..33333 --input ../afa/2019-11-05_prophage_seq.afa --output ../afa/2019-11-05_prophage_pf1_pf7_13982-33333.afa
esl-reformat -d afa ../afa/2019-11-05_prophage_pf1_pf7_13982-33333.afa > 2019-11-05_prophage_pf1_pf7_13982-33333_dna.afa
FastTree -nt afa/2019-11-05_prophage_pf1_pf7_13982-33333_dna.afa > newick/2019-11-05_prophage_pf1_pf7_13982-33333_dna.newick

# got pf4r seq from pseudomonas.com: http://pseudomonas.com/feature/show/?id=152109732&view=sequence
hmmbuild ../../hmm/viral_proteins/pf4r.hmm pf4r.fasta
cp 2019-11-05_viral_and_no_phage_bac.hmm 2019-11-06_viral_bac_pf4r.hmm
cat ../pf4r.hmm >> 2019-11-06_viral_bac_pf4r.hmm
hmmpress 2019-11-06_viral_bac_pf4r.hmm

python3 generate_domtbls.py --g 11 ../seq/fasta/review_paper_phage/ ../hmm/viral_protein/2019-11-06_viral_bac_pf4r.hmm ../tables/domtbl/2019-11-06_rev_phage_pf4r/
mv ../tables/domtbl/2019-11-06_rev_phage_pf4r ../tables/domtbl/2019-11-06_rev_phage_pf4r_swissprot
python3 generate_domtbls.py --g 11 ../seq/fasta/review_paper_phage/ ../hmm/Pfam-A.hmm ../tables/domtbl/2019-11-06_rev_phage_pf4r_pfam

perl scan_domtbls.pl --input ../../../tables/domtbl/2019-11-06_rev_phage_pf4r_swissprot/ --output ../../../tables/domtbl/2019-11-06_rev_phage_pf4r_swissprot_scanned/ -v
perl scan_domtbls.pl --input ../../../tables/domtbl/2019-11-06_rev_phage_pf4r_pfam/ --output ../../../tables/domtbl/2019-11-06_rev_phage_pf4r_pfam_scanned/ -v

cd ../visualize/spoof_charts
rm *

# replaced all instances of pf4r data lines with |pf4r| to work better with swissprot-focused regex
python visualize_nucleotide_counts.py spoof_charts/ review_paper_phage_plots/ --swissprot_domtbl ../../../tables/domtbl/2019-11-06_rev_phage_pf4r_swissprot_scanned/ --pfam_domtbl ../../../tables/domtbl/2019-11-06_rev_phage_pf4r_pfam_scanned/

# rooted phylogeny timeeee
cat 2019-11-05_prophage_seq.fasta > 2019-11-05_rooted_phylo_seq.fasta
mv 2019-11-06_rooted_phylo_seq.fasta

mafft --reorder --thread 6 seq/prophage_seq/2019-11-06_rooted_phylo_seq.fasta > afa/2019-11-06_rooted_phylo_seq.afa
perl fetch_ali_column.pl -c 13952..33333 -i ../afa/2019-11-06_rooted_phylo_seq.afa -o ../afa/2019-11-06_rooted_phylo_seq_13952-33333.afa
esl-reformat -d afa ../afa/2019-11-06_rooted_phylo_seq_13952-33333.afa > ../afa/2019-11-06_rooted_phylo_seq_13952-33333_dna.afa
FastTree -nt afa/2019-11-06_rooted_phylo_seq_13952-33333_dna.afa > newick/2019-11-06_rooted_phylo_13952-33333.newick

cp 2019-08-02_complete_3.3dev_scanned/* 2019-08-02_complete_3.3dev_scanned_non-aer/
mv 2019-08-02_complete_3.3dev_scanned_non-aer/*aeruginosa* 2019-08-02_complete_3.3dev_scanned_aer/

perl no_cluster_table_parser.pl --dfam ../../../tables/dfam/2019-08-02_complete_3.3dev_scanned_aer/ --bac_genome ../../../sequence_files/pseudomonas/complete_genomes/ --tsv ../../../tables/tsv/2019-08-02_complete_3.3dev_scanned_aer/ --index_chart ../../../tables/nuc_chart/2019-08-02_complete_3.3dev_scanned_aer/ --verbose --force

perl no_cluster_table_parser.pl --dfam ../../../tables/dfam/2019-08-02_complete_3.3dev_scanned_non-aer/ --bac_genome ../../../sequence_files/pseudomonas/complete_genomes/ --tsv ../../../tables/tsv/2019-08-02_complete_3.3dev_scanned_non-aer/ --index_chart ../../../tables/nuc_chart/2019-08-02_complete_3.3dev_scanned_non-aer/ --verbose --force

perl combine_charts.pl --inputdir ../../../tables/nuc_chart/2019-08-02_complete_3.3dev_scanned_aer/ --outputdir ../../../tables/nuc_chart/2019-08-02_complete_3.3dev_scanned_aer_combined/ -f
perl combine_charts.pl --inputdir ../../../tables/nuc_chart/2019-08-02_complete_3.3dev_scanned_non-aer/ --outputdir ../../../tables/nuc_chart/2019-08-02_complete_3.3dev_scanned_non-aer_combined/ -f

python visualize_nucleotide_counts.py ../../../tables/nuc_chart/2019-08-02_complete_3.3dev_scanned_aer_combined/ ../../../pdf/2019-08-02_complete_aer_plots/ --swissprot_domtbl ../../../tables/domtbl/2019-08-02_swissprot_prophage_code11_scanned/ --pfam_domtbl ../../../tables/domtbl/2019-07-03_Pfam_A_prophage_scanned/ --dfam_dir ../../../tables/dfam/2019-07-25_phage_nuc_annotations_scanned/
python visualize_nucleotide_counts.py ../../../tables/nuc_chart/2019-08-02_complete_3.3dev_scanned_non-aer_combined/ ../../../pdf/2019-08-02_complete_non-aer_plots/ --swissprot_domtbl ../../../tables/domtbl/2019-08-02_swissprot_prophage_code11_scanned/ --pfam_domtbl ../../../tables/domtbl/2019-07-03_Pfam_A_prophage_scanned/ --dfam_dir ../../../tables/dfam/2019-07-25_phage_nuc_annotations_scanned/

python integrase_dist_plot.py --pdf_output ../../../pdf/aer_int_dist.pdf --swissprot_domtbl ../../../tables/domtbl/2019-08-02_swissprot_prophage_code11_scanned/  --pfam_domtbl ../../../tables/domtbl/2019-07-03_Pfam_A_prophage_scanned/  --swissprot_fasta ../../../sequence_files/viral_proteins/amino/uniprot-reviewed-viral-coat-prot.fasta --dfam_dir ../../../tables/dfam/2019-07-25_phage_nuc_annotations_scanned/ --dfam_fasta ../../../sequence_files/viral_proteins/nuc/all_nuc_seqs.fasta --bac_dfams ../../../tables/dfam/2019-08-02_complete_3.3dev_scanned_aer/ --csv_output ../../../pdf/aer_int_dist.csv

python integrase_dist_plot.py --pdf_output ../../../pdf/non-aer_int_dist.pdf --swissprot_domtbl ../../../tables/domtbl/2019-08-02_swissprot_prophage_code11_scanned/  --pfam_domtbl ../../../tables/domtbl/2019-07-03_Pfam_A_prophage_scanned/  --swissprot_fasta ../../../sequence_files/viral_proteins/amino/uniprot-reviewed-viral-coat-prot.fasta --dfam_dir ../../../tables/dfam/2019-07-25_phage_nuc_annotations_scanned/ --dfam_fasta ../../../sequence_files/viral_proteins/nuc/all_nuc_seqs.fasta --bac_dfams ../../../tables/dfam/2019-08-02_complete_3.3dev_scanned_non-aer/ --csv_output ../../../pdf/non-aer_int_dist.csv

# phylogeny with no pseudophages
mafft --reorder --thread 6 afa/2019-11-08_rooted_no_pseudo_phage.afa > afa/2019-11-08_rooted_no_pseudo_phage_mafft.afa
esl-reformat -d afa 2019-11-08_rooted_no_pseudo_phage_mafft.afa > 2019-11-08_rooted_no_pseudo_phage_mafft_dna.afa
FastTree -nt afa/2019-11-08_rooted_no_pseudo_phage_mafft_dna.afa > newick/2019-11-08_rooted_no_pseudo_phage_mafft_dna.newick

=====
# Filter out bad SwissProt, TrEMBL entries (with > occurring mid-header) 11/14/2019
perl uniprot_header_scan.pl --input ../../../sequence_files/uniprot/uniprot_sprot.fasta -o swissprot_entries.fasta -v
perl uniprot_header_scan.pl --input ../../../sequence_files/uniprot/uniprot_trembl.fasta -o trembl_entries.fasta -v

=====
# Work on generating PA0721 phylo 11/20/2019
perl remove_dashes.pl --input ../../../sequence_files/prophage/2019-11-08_no_pseudo_phage.afa --output ../../../sequence_files/prophage/2019-11-08_no_pseudo_phage.fasta

perl hmmbuild_mult_fasta.pl -i ../../../sequence_files/afa/phage_resistance_seq/ -o ../../../hmm/phage_resistance_seq/ --hmmpress -v -f

hmmsearcht -A sequence_files/afa/PA0720_ps_aer_no_pseudo_code11.afa -c 11 -o tables/hmmout/phage_resist/PA0720_ps_aer_no_pseudo_code11.hmmout hmm/phage_resistance_seq/PA0720_ps_aer.hmm sequence_files/prophage/2019-11-08_no_pseudo_phage.fasta

hmmsearcht -A sequence_files/afa/PA0721_ps_aer_no_pseudo_code11.afa -c 11 -o tables/hmmout/phage_resist/PA0721_ps_aer_no_pseudo_code11.hmmout hmm/phage_resistance_seq/PA0721_ps_aer.hmm sequence_files/prophage/2019-11-08_no_pseudo_phage.fasta

hmmsearcht -A sequence_files/afa/PA0722_ps_aer_no_pseudo_code11.afa -c 11 -o tables/hmmout/phage_resist/PA0722_ps_aer_no_pseudo_code11.hmmout hmm/phage_resistance_seq/PA0722_ps_aer.hmm sequence_files/prophage/2019-11-08_no_pseudo_phage.fasta

hmmsearcht -A sequence_files/afa/PA0723_ps_aer_no_pseudo_code11.afa -c 11 -o tables/hmmout/phage_resist/PA0723_ps_aer_no_pseudo_code11.hmmout hmm/phage_resistance_seq/PA0723_ps_aer.hmm sequence_files/prophage/2019-11-08_no_pseudo_phage.fasta

perl concatenate_afas.pl --afa_dir ../../../sequence_files/afa/phage_resist_hmmsearcht_code11/ --seq_db ../../../sequence_files/prophage/2019-11-08_no_pseudo_phage.fasta -o ../../../sequence_files/afa/concatenated_PA072X.afa
Hey, put redundant code in a method and call it!
Warning: Omitting Pf_prophage_strain_X13273_1374860_-_1380892 from output because no entries were found matching this species
Warning: Omitting Pf_prophage_estimate_414927-419731_strain_w60856 from output because no entries were found matching this species
Warning: Omitting Pf_prophage_estimate_2002373-2007389_strain_NCGM1900 from output because no entries were found matching this species

=====
# Creating vis chart with protein annotation 11/23/2019:
python generate_domtbls.py --g 11 pf1_fasta/ ../../../hmm/viral_proteins/swissprot_viral_prots.hmm pf1_domtbl/
mv pf1_domtbl/ pf1_domtbl_swissprot
hmmpress ../../../hmm/Pfam_A/Pfam-A.hmm
python generate_domtbls.py --g 11 pf1_fasta/ ../../../hmm/Pfam_A/Pfam-A.hmm pf1_domtbl_pfam/
perl spoof_charts.pl --input ../viral_annotation/pf1_fasta/pf1.fasta --output pf1_chart/
perl scan_domtbls.pl --input pf1_domtbl_swissprot --output pf1_domtbl_swissprot_scanned/
perl scan_domtbls.pl --input pf1_domtbl_pfam --output pf1_domtbl_pfam_scanned/
python visualize_nucleotide_counts.py --swissprot_domtbl ../viral_annotation/pf1_domtbl_swissprot_scanned/ --pfam_domtbl ../viral_annotation/pf1_domtbl_pfam_scanned/ pf1_chart/ pf1_pdf/

=====
# Trying again to make phylogeny after correcting for duplicated seq and overlapping matches 11/27/2019
hmmsearcht -A sequence_files/afa/phage_resist_hmmsearcht_code11/PA0720_ps_aer_no_pseudo_code11.afa -c 11 -E 1e-10 -o tables/hmmout/phage_resist/PA0720_ps_aer_no_pseudo_code11.hmmout hmm/phage_resistance_seq/PA0720_ps_aer.hmm sequence_files/prophage/2019-11-27_no_pseudo_phage_pf1_corrected.fasta
hmmsearcht -A sequence_files/afa/phage_resist_hmmsearcht_code11/PA0721_ps_aer_no_pseudo_code11.afa -c 11 -E 1e-10 -o tables/hmmout/phage_resist/PA0721_ps_aer_no_pseudo_code11.hmmout hmm/phage_resistance_seq/PA0721_ps_aer.hmm sequence_files/prophage/2019-11-27_no_pseudo_phage_pf1_corrected.fasta
hmmsearcht -A sequence_files/afa/phage_resist_hmmsearcht_code11/PA0722_ps_aer_no_pseudo_code11.afa -c 11 -E 1e-10 -o tables/hmmout/phage_resist/PA0722_ps_aer_no_pseudo_code11.hmmout hmm/phage_resistance_seq/PA0722_ps_aer.hmm sequence_files/prophage/2019-11-27_no_pseudo_phage_pf1_corrected.fasta
hmmsearcht -A sequence_files/afa/phage_resist_hmmsearcht_code11/PA0723_ps_aer_no_pseudo_code11.afa -c 11 -E 1e-10 -o tables/hmmout/phage_resist/PA0723_ps_aer_no_pseudo_code11.hmmout hmm/phage_resistance_seq/PA0723_ps_aer.hmm sequence_files/prophage/2019-11-27_no_pseudo_phage_pf1_corrected.fasta

perl concatenate_afas.pl --afa_dir ../../../sequence_files/afa/phage_resist_hmmsearcht_code11/ --seq_db ../../../sequence_files/prophage/2019-11-27_no_pseudo_phage_pf1_corrected.fasta -o ../../../sequence_files/afa/concatenated_PA072X.afa
Hey, put redundant code in a method and call it!
Warning: Omitting Pf_prophage_estimate_414927-419731_strain_w60856 from output because no entries were found matching this species
Warning: Omitting Pf_prophage_strain_X13273_1374860_-_1380892 from output because no entries were found matching this species
Warning: Omitting Pf_prophage_estimate_2002373-2007389_strain_NCGM1900 from output because no entries were found matching this species

# FastTree Version 2.1.10 Double precision (No SSE3) on laptop
fasttree  sequence_files/afa/concatenated_PA072X.afa > newick/2019-11-27_concatenated_PA072X.newick

=====
# Working on running new Ps.com database w/ ~530 complete genomes through pipeline, using new phage seq
# After manually fiddling with seq files to use Pf1, Pf4, Pf5, Pf6, Pf7 names and including pseudo phages, convert one RNA entry to DNA
esl-reformat -d fasta 2019-12-09_all_phage_pf1_corrected.fasta > 2019-12-09_all_phage_pf1_corrected_dna.fasta